SELECT COUNT (*)
FROM
  (SELECT DISTINCT CM.T_PRICE_PLAN,
    CM.T_SUB_MARKET_CODE,
    CM.T_FEATURE_CODE,
    DECODE ( CM.T_PRICE_PLAN, 'DEFINR', TRUNC (SYSDATE + 1),
    (SELECT MAX (EFFECTIVE_DATE)
    FROM
      &Schema.PRICE_PLAN
    WHERE PRICE_PLAN     = CM.T_PRICE_PLAN
    AND EXPIRATION_DATE IS NULL
    )) AS EFFECTIVE_DATE,
    TO_DATE ('&STT', 'mm/dd/yyyy hh:mi:ss PM'),
    NULL,
    '&OperatorID'             AS OPERATOR_ID,
    '&TRNum'                  AS APPLICATION_ID,
    'TR'                      AS DL_SERVICE_CODE,
    TO_CHAR (SYSDATE, 'MMDD') AS DL_UPDATE_STAMP,
    A.OC_INFO_IND,
    A.UC_INFO_IND,
    A.RC_INFO_IND,
    A.OTHER_INFO_IND,
    A.EXPIRATION_DATE,
    A.SALE_EXP_DATE,
    (SELECT FEATURE_DESC
    FROM
      &Schema.FEATURE
    WHERE FEATURE_CODE = CM.T_FEATURE_CODE
    ),
    A.UNIT_GROUP,
    A.NON_EXCLUDABLE_IND,
    A.PRIMARY_SVC_IND,
    A.AUTO_SALE_RANK
  FROM
    &Schema.RATED_FEATURE A,
    TBLOPER.WHOLESALE_CLONE_SC1 CM
  WHERE A.PRICE_PLAN    = CM.S_PRICE_PLAN
  AND A.SUB_MARKET_CODE = CM.S_SUB_MARKET_CODE
  AND A.FEATURE_CODE    = CM.S_FEATURE_CODE
  AND CM.RUN_ID         =
    &RunID
  AND (CM.T_PRICE_PLAN, CM.T_SUB_MARKET_CODE, CM.T_FEATURE_CODE) NOT IN
    (SELECT PRICE_PLAN,
      SUB_MARKET_CODE,
      FEATURE_CODE
    FROM
      &Schema.RATED_FEATURE
    WHERE PRICE_PLAN    = CM.T_PRICE_PLAN
    AND SUB_MARKET_CODE = CM.T_SUB_MARKET_CODE
    AND FEATURE_CODE    = CM.T_FEATURE_CODE
    )
  );
